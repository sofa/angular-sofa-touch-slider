/**
 * angular-sofa-touch-slider - v0.1.0 - Mon Jan 12 2015 14:45:01 GMT+0100 (CET)
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO)
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(e){e.module("sofa.touchSlider",["sofa-touch-slider.tpl.html","sofa-touch-slider-indicator.tpl.html"]),e.module("sofa-touch-slider-indicator.tpl.html",[]).run(["$templateCache",function(e){e.put("sofa-touch-slider-indicator.tpl.html",'<ul class="sofa-touch-slider-indicator">\n    <li ng-repeat="item in items" class="sofa-touch-slider-indicator__item"\n        ng-class="{\'sofa-touch-slider-indicator__item--active\': $index === activeIndex}">\n    </li>\n</ul>\n')}]),e.module("sofa-touch-slider.tpl.html",[]).run(["$templateCache",function(e){e.put("sofa-touch-slider.tpl.html",'<div class="sofa-touch-slider-wrapper">\n    <div class="sofa-touch-slider-mask">\n        <ul class="sofa-touch-slider sofa-touch-slider--show-{{displayItems}}"></ul>\n    </div>\n    <sofa-touch-slider-indicator ng-if="showIndicator"></sofa-touch-slider-indicator>\n</div>')}]),e.module("sofa.touchSlider").directive("sofaTouchSlider",["$window","$rootScope",function(t,n){"use strict";var i=1,s=325,o="",a="transform",r="transition",l="sofa-touch-slider-max--left",d="sofa-touch-slider-max--right",c="sofa-touch-slider-no-flexbox",u=function(){var e=document.createElement("div");["flex","msFlex","MozFlex","webkitFlex"].every(function(t){return void 0!==e.style[t]?(o=t,!1):!0})},f=function(){["webkit","Moz","O","ms"].every(function(e){var t=e+"Transform";return void 0!==document.body.style[t]?(a=t,!1):!0})},h=function(){void 0!==document.body.style.webkitTransition&&(r="webkitTransition")};o||(u(),f(),h());var m=!!o;return t.addEventListener("resize",function(){n.$emit("sofaTouchSlider.resize")}),{restrict:"E",transclude:!0,replace:!0,scope:{items:"=",displayItems:"=",onItemClick:"&",snap:"@?",slideIndex:"=?",selectedIndex:"=?"},templateUrl:"sofa-touch-slider.tpl.html",controller:["$scope",function(e){this.getItems=function(){return e.items},this.getSlideIndex=function(){return e.slideIndex}}],link:function(n,u,f,h,p){if(!e.isFunction(t.Hammer))throw new Error("Hammer.js is missing");void 0===n.slideIndex&&(n.slideIndex=0);var I;n.$onRootScope("sofaTouchSlider.resize",function(){I.reset()}),n.slideToIndex=function(e){I.slideToIndex(e)},n.setToIndex=function(e){I.setToIndex(e)},n.reset=function(){I.reset()};var v=function(){var h,I,v,x,w,g=e.element(u[0].querySelector(".sofa-touch-slider")),y=g[0],T=y.getBoundingClientRect(),M=T.width,S=n.items.length,b=f.displayItems,$=M/b,C=100/b,F=-parseInt($*(S-b),10),k=n.snap?$:!1,E=0,H=0,_=0,A=n.slideIndex,X=[];if(!m){var q=$*S;g.css("width",q+"px"),u.addClass(c)}u.addClass(l);var z=function(){m||g.css("width","100%"),T=y.getBoundingClientRect(),M=T.width,$=M/b,F=-parseInt($*(S-b),10),k=n.snap?$:!1,m||(q=$*S,g.css("width",q+"px"),X.forEach(function(e){e.style.width=$+"px"})),O(n.slideIndex)},R=function(e,t){F>=e?(e=F,E=e,u.addClass(d)):e>=0?(e=0,E=e,u.addClass(l)):u.removeClass(l+" "+d),t&&(E=e),n.slideIndex=Math.abs(parseInt(E/$,10)),A!==n.slideIndex&&(A=n.slideIndex,n.$apply()),y.style[a]="translateX("+e+"px)"},D=function(e){E=$*e*-1,y.style[a]="translateX("+E+"px)"},O=function(e){y.style[r]="none",D(e);y.offsetHeight;y.style[r]=""},L=function(e){var n,i;v||(v=parseInt(e,10)),x=parseInt(e,10)-v,n=-_*Math.exp(-x/s),i=parseInt(h+n,10),n>=1||-1>=n?(R(i),I=t.requestAnimationFrame(L)):(v=null,x=null,R(i,!0))},N=new Hammer.Manager(y),B=new Hammer.Pan({direction:Hammer.DIRECTION_HORIZONTAL,threshold:10,touchAction:"pan"});N.add(B),N.on("panstart",function(e){e.preventDefault(),t.cancelAnimationFrame(I),H=E,E=H+parseInt(e.deltaX,10),R(E)}),N.on("panend",function(e){e.preventDefault();var n=parseFloat((Math.abs(e.deltaX)/e.deltaTime).toFixed(1));if(H=E,E>F||0>E)if(n>=.5){if(h=Math.round(E+e.deltaX*Math.max(n,1)),k){var s=Math.round(h/k)*k,o=Math.abs(Math.abs(h)-Math.abs(H));k/o>4&&(2===e.direction?s=Math.round((h-k)/k)*k:4===e.direction&&(s=Math.round((h+k)/k)*k)),h=s}I=t.requestAnimationFrame(L)}else k&&(_=parseInt(i/b,10),h=Math.round(E/k)*k,I=t.requestAnimationFrame(L))}),N.on("panmove",function(e){e.preventDefault(),w=e,E=H+parseInt(e.deltaX,10),R(E)});var U=function(){var t=C%1===0?C:C.toFixed(5);g.innerHTML="";for(var i=0;i<n.items.length;i+=1){var s=n.$new();s.item=n.items[i],s.index=i,p(s,function(n){var i=document.createElement("li");i.className="sofa-touch-slider__item",o?i.style[o]="1 0 "+t+"%":i.style.width=$+"px",X.push(i),g.append(e.element(i).append(n))})}};return U(),{slideToIndex:D,setToIndex:O,reset:z}};if(n.items&&n.items.length)I=v(),n.showIndicator=f.showIndicator&&n.items.length>1;else var x=n.$watch("items",function(e){e&&e.length&&(I=v(),n.showIndicator=f.showIndicator&&n.items.length>1,x())})}}}]),e.module("sofa.touchSlider").directive("sofaTouchSliderIndicator",function(){"use strict";return{restrict:"E",require:"^sofaTouchSlider",replace:!0,templateUrl:"sofa-touch-slider-indicator.tpl.html",link:function(e,t,n,i){e.items=i.getItems(),e.activeIndex=0,e.$watch(function(){return i.getSlideIndex()},function(t){e.activeIndex=t})}}})}(angular);